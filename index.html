<head>
    <meta charset="utf-8">
    <title>Desafio do Muro</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <style>
        .padding-muro {
            display: block;
            height: 2px;
            width: 100%;
        }
    </style>
    <script>
        $(document).ready(function () {
            var person = "<i class='fa fa-cat'></i>";
            var wall = "<i class='fa fa-chess-board'></i>";
            var door = "<i class='fa fa-archway'></i>";
            var tamanhoMuro = 51;
            var arrayMuro = [];
            var posicaoPessoa = 0;
            var posicaoPorta = 0;

            gerarTelaAutomática();

            $("#reset").click(
                function () {
                    location.reload();
                }
            );

            $("#executar").click(
                function () {
                    var posicao = encontrarPorta(posicaoPessoa, tamanhoMuro);
                    if (posicao == null) {
                        alert("Porta não encontrada");
                    } else {
                        alert("Porta encontrada em: " + posicao);
                    }
                }
            );

            function gerarTelaAutomática() {
                posicaoPessoa = Math.floor(tamanhoMuro / 2);
                posicaoPorta = posicaoPessoa;

                while (posicaoPorta == posicaoPessoa) {
                    posicaoPorta = Math.floor(Math.random() * (tamanhoMuro - 1));;
                }

                for (let index = 0; index < tamanhoMuro; index++) {
                    if (posicaoPorta == index) {
                        arrayMuro.push(1);
                    } else {
                        arrayMuro.push(0);
                    }
                }

                var stringMuro = obterTelaAtual();

                $("#screen").html(stringMuro);
            }

            function obterTelaAtual() {
                let stringMuro = '';
                for (let index = 0; index < arrayMuro.length; index++) {
                    const element = arrayMuro[index];
                    if (index == posicaoPessoa) {
                        stringMuro += person;
                    } else if (element == 1) {
                        stringMuro += door;
                    } else {
                        stringMuro += wall;
                    }
                }
                return stringMuro;
            }

            function imprimirPosicaoAtual() {
                $("#movements").html($("#movements").html() + "<div class='padding-muro'></div>" + obterTelaAtual());
            }

            function encontrarPorta(inicio, fim) {
                posicaoPessoa = inicio;
                imprimirPosicaoAtual();
                if (arrayMuro[inicio] == 1) { // sucesso
                    return inicio;
                }
                if (inicio == fim) {
                    return null;
                }

                return encontrarPorta(inicio + 1, fim);
            }
        })
    </script>
</head>

<body>
    <div class="row">
        <div class="col-12">
            <h2>
                Desafio do Muro
                <button type="button" id="reset" class="btn btn-primary">Resetar</button>
            </h2>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div id="screen"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <br>
            <button type="button" id="executar" class="btn btn-success">
                Executar algorítmo
            </button>
            <br>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div id="movements"></div>
        </div>
    </div>
</body>